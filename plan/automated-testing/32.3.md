# TASK-032.3: Test getAgentStatus - job name matching

**Section**: 3. QueueManager Enhancements
**Subsection**: 3.5.3
**Task ID**: TASK-032.3

## Description

Add a test case for the `getAgentStatus` method to verify it correctly finds agents by matching `job.name` against the agent name pattern. This verifies one of the job matching strategies.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/queue/queue-manager.ts` - `getAgentStatus()` method

## Current State

The `getAgentStatus` method:
- Matches jobs by `job.name === 'agent:{name}'` pattern
- Uses this as one strategy to find agents

The test file `tests/queue/queue-manager.test.ts` exists with previous tests including TASK-032.1 and TASK-032.2.

**Important**: This task should be executed after TASK-032.2.

## Checklist

### Preparation and Setup

- [ ] Review `getAgentStatus` job name matching implementation
- [ ] Understand job name format: `agent:{name}`
- [ ] Review test setup from previous subtasks

### Implementation Steps

- [ ] Step 1: Write test for job name matching
  - [ ] Create test: `it('should find agent by job name', async () => { ... })`
  - [ ] Arrange: Job with `name === 'agent:test'`
  - [ ] Act: Call `getAgentStatus('test')`
  - [ ] Assert: Agent found

### Specific Requirements

- [ ] Requirement 1: Test must verify job name matching
  - Acceptance: Jobs with `name === 'agent:{name}'` are matched
- [ ] Requirement 2: Test must verify pattern matching
  - Acceptance: Agent name is correctly extracted from job name

### Error Handling and Edge Cases

- [ ] Handle case where job name doesn't match pattern
- [ ] Verify case sensitivity (if applicable)
- [ ] Test with various job name formats

### Testing

- [ ] Run `npm run test:unit` to verify test executes
- [ ] Verify test passes consistently
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining job name matching
- [ ] Document job name format

### Verification

- [ ] Verify test passes consistently
- [ ] Verify job name matching works
- [ ] Confirm test follows project conventions

## Notes

- This task is part of **Phase 3 â€“ QueueManager Enhancements**
- **Execution Timing**: Should be executed after TASK-032.2
- **Dependencies**: 
  - TASK-031: Add tests for addDelayedAgent
  - TASK-032.2: Test getAgentStatus - agent found with complete status
- **Important Considerations**: 
  - Job name matching uses pattern `agent:{name}`
  - This is the third of 5 subtasks for TASK-032
- **Task Independence**: Can be completed independently after TASK-032.2
- **Current State**: Test file exists with previous tests

## Related Tasks

- Parent: TASK-032 (Add tests for getAgentStatus and findAgentQueue)
- Previous: TASK-032.2 (Test getAgentStatus - agent found with complete status)
- Next: TASK-032.4 (Test getAgentStatus - agentName in data matching)
- Dependencies:
  - TASK-032.2: Test getAgentStatus - agent found with complete status
- Related:
  - TASK-032.1, TASK-032.2, TASK-032.4, TASK-032.5: Other subtasks

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing a test case for `getAgentStatus` job name matching.

**Definition of Done**: "A test case is written that verifies `getAgentStatus` correctly finds agents by matching `job.name` against the agent name pattern. The test passes consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify job name matching works so that agents can be found by job name.
   - **Acceptance Criteria**: 
     - Test verifies jobs with `name === 'agent:{name}'` are matched
     - Test passes consistently

### Automated Tests

The test case should be:

```typescript
describe('getAgentStatus', () => {
  it('should find agent by job name', async () => {
    // Arrange: Job with name === 'agent:test'
    const mockQueues = [{
      getWaiting: jest.fn().mockResolvedValue([
        { id: '1', name: 'agent:test', data: {} },
      ]),
    }];
    // Act: getAgentStatus('test')
    // Assert: Agent found
  });
});
```

- [ ] Test case written and passes
- [ ] Test verifies job name matching

### Git Commit and Push Requirements

- [ ] Test case added to `tests/queue/queue-manager.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add getAgentStatus job name matching test")
- [ ] Changes are pushed to origin
- [ ] Commit includes only this test case

### Final Checklist

- [ ] Test case written and passes
- [ ] Test verifies job name matching
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

