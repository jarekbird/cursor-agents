# TASK-032.1: Test getAgentStatus - agent not found

**Section**: 3. QueueManager Enhancements
**Subsection**: 3.5.1
**Task ID**: TASK-032.1

## Description

Add a test case for the `getAgentStatus` method to verify it returns `null` when an agent is not found across all queues. This is the simplest case and should be tested first.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/queue/queue-manager.ts` - `getAgentStatus()` method

## Current State

The `getAgentStatus` method:
- Searches across all queues for an agent by name
- Returns `null` if agent not found

The test file `tests/queue/queue-manager.test.ts` exists but may not have comprehensive `getAgentStatus` tests.

**Important**: This task should be executed after TASK-031. This is the first subtask of TASK-032.

## Checklist

### Preparation and Setup

- [ ] Review `getAgentStatus` implementation
- [ ] Understand agent matching logic
- [ ] Review existing test structure

### Implementation Steps

- [ ] Step 1: Write test for agent not found
  - [ ] Create test: `it('should return null when agent is not found', async () => { ... })`
  - [ ] Arrange: 
    - [ ] Mock queues with no matching jobs
  - [ ] Act: Call `getAgentStatus('non-existent-agent')`
  - [ ] Assert: Returns `null`

### Specific Requirements

- [ ] Requirement 1: Test must verify not found case
  - Acceptance: Returns `null` when agent doesn't exist
- [ ] Requirement 2: Test must verify queue search
  - Acceptance: Method searches across all queues

### Error Handling and Edge Cases

- [ ] Handle case where no queues exist
- [ ] Handle case where queues exist but no matching jobs

### Testing

- [ ] Run `npm run test:unit` to verify test executes
- [ ] Verify test passes consistently
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining not found behavior

### Verification

- [ ] Verify test passes consistently
- [ ] Verify not found handling works
- [ ] Confirm test follows project conventions

## Notes

- This task is part of **Phase 3 â€“ QueueManager Enhancements**
- **Execution Timing**: Should be executed after TASK-031
- **Dependencies**: 
  - TASK-031: Add tests for addDelayedAgent
- **Important Considerations**: 
  - This is the first of 5 subtasks for TASK-032
  - Simple test case to establish pattern
- **Task Independence**: Can be completed independently after TASK-031
- **Current State**: Test file exists but may not have comprehensive getAgentStatus tests

## Related Tasks

- Parent: TASK-032 (Add tests for getAgentStatus and findAgentQueue)
- Next: TASK-032.2 (Test getAgentStatus - agent found with complete status)
- Dependencies:
  - TASK-031: Add tests for addDelayedAgent
- Related:
  - TASK-032.2 through TASK-032.5: Other subtasks for getAgentStatus and findAgentQueue

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing a test case for `getAgentStatus` when agent is not found.

**Definition of Done**: "A test case is written that verifies `getAgentStatus` returns `null` when an agent is not found. The test passes consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify not found handling works so that missing agents are handled gracefully.
   - **Acceptance Criteria**: 
     - Test verifies null is returned when agent doesn't exist
     - Test passes consistently

### Automated Tests

The test case should be:

```typescript
describe('getAgentStatus', () => {
  it('should return null when agent is not found', async () => {
    // Arrange: Mock queues with no matching jobs
    const mockQueues = [];
    const queueManager = new QueueManager(mockRedis);
    
    // Act
    const result = await queueManager.getAgentStatus('non-existent-agent');
    
    // Assert
    expect(result).toBeNull();
  });
});
```

- [ ] Test case written and passes
- [ ] Test verifies not found returns null

### Git Commit and Push Requirements

- [ ] Test case added to `tests/queue/queue-manager.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add getAgentStatus not found test")
- [ ] Changes are pushed to origin
- [ ] Commit includes only this test case

### Final Checklist

- [ ] Test case written and passes
- [ ] Test verifies not found handling
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

