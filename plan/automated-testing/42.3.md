# TASK-042.3: Add tests for GET /agents/:name endpoint

**Section**: 5. HTTP/API Black-box Tests (App)
**Subsection**: 5.5.3
**Task ID**: TASK-042.3

## Description

Add test cases for the `GET /agents/:name` endpoint to verify it correctly returns agent status for existing agents, returns 404 for missing agents, and handles errors appropriately.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/app.ts` - `GET /agents/:name` endpoint
- `virtual-assistant/cursor-agents/tests/app.test.ts` - existing test structure

## Current State

The `GET /agents/:name` endpoint:
- Gets status for specific agent
- Returns 404 when agent not found
- Returns 500 when getAgentStatus throws

The test file `tests/app.test.ts` exists with previous tests including TASK-042.1 and TASK-042.2.

**Important**: This task should be executed after TASK-042.2.

## Checklist

### Preparation and Setup

- [ ] Review `GET /agents/:name` endpoint implementation
- [ ] Understand `getAgentStatus` usage
- [ ] Review test setup from previous subtasks

### Implementation Steps

- [ ] Step 1: Write tests for GET /agents/:name
  - [ ] Create test: `it('should return agent status when agent exists', async () => { ... })`
    - [ ] Arrange: Mock `getAgentStatus` to return status object
    - [ ] Act: GET `/agents/test`
    - [ ] Assert: 200, status JSON
  - [ ] Create test: `it('should return 404 when agent not found', async () => { ... })`
    - [ ] Arrange: `getAgentStatus` returns `null`
    - [ ] Act: GET `/agents/non-existent`
    - [ ] Assert: 404, message "Agent \"non-existent\" not found"
  - [ ] Create test: `it('should return 500 when getAgentStatus throws', async () => { ... })`
    - [ ] Arrange: `getAgentStatus` throws
    - [ ] Act: GET `/agents/test`
    - [ ] Assert: 500, error message

### Specific Requirements

- [ ] Requirement 1: Test must verify GET /agents/:name
  - Acceptance: Returns status for existing agents, 404 for missing, 500 for errors
- [ ] Requirement 2: Test must verify error messages
  - Acceptance: Error messages match implementation exactly

### Error Handling and Edge Cases

- [ ] Handle case where agent name contains special characters
- [ ] Verify error messages are descriptive
- [ ] Test with various agent states

### Testing

- [ ] Run `npm run test:http` to verify all tests execute
- [ ] Verify all test cases pass
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining agent status retrieval
- [ ] Note error handling approach

### Verification

- [ ] Verify all test cases pass consistently
- [ ] Verify agent status retrieval works
- [ ] Verify error handling works
- [ ] Confirm tests follow project conventions

## Notes

- This task is part of **Phase 5 â€“ HTTP/API Black-box Tests (App)**
- **Execution Timing**: Should be executed after TASK-042.2
- **Dependencies**: 
  - TASK-042.2: Add tests for GET /agents endpoint
- **Important Considerations**: 
  - This is the third of 4 subtasks for TASK-042
  - Error messages should match implementation exactly
- **Task Independence**: Can be completed independently after TASK-042.2
- **Current State**: Test file exists with previous tests

## Related Tasks

- Parent: TASK-042 (Add tests for /agents endpoints)
- Previous: TASK-042.2 (Add tests for GET /agents endpoint)
- Next: TASK-042.4 (Add tests for DELETE /agents/:name endpoint)
- Dependencies:
  - TASK-042.2: Add tests for GET /agents endpoint
- Related:
  - TASK-042.1, TASK-042.2, TASK-042.4: Other subtasks

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves adding test cases for the `GET /agents/:name` endpoint.

**Definition of Done**: "Test cases are added that verify `GET /agents/:name` correctly returns agent status for existing agents, returns 404 for missing agents, and handles errors. All tests pass consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify agent status retrieval works so that individual agent state can be checked.
   - **Acceptance Criteria**:
     - Test verifies existing agents return status
     - Test verifies missing agents return 404
     - Test verifies errors return 500

### Automated Tests

Test cases should include:

```typescript
describe('GET /agents/:name', () => {
  it('should return agent status when agent exists', async () => {
    // Arrange: Mock getAgentStatus to return status
    // Act: GET /agents/test
    // Assert: 200, status JSON
  });
  
  it('should return 404 when agent not found', async () => {
    // Arrange: getAgentStatus returns null
    // Act: GET /agents/non-existent
    // Assert: 404, message "Agent \"non-existent\" not found"
  });
  
  it('should return 500 when getAgentStatus throws', async () => {
    // Arrange: getAgentStatus throws
    // Act: GET /agents/test
    // Assert: 500, error message
  });
});
```

- [ ] All test cases written and pass
- [ ] Tests verify agent status retrieval
- [ ] Tests verify error handling

### Git Commit and Push Requirements

- [ ] Test cases added to `tests/app.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add GET /agents/:name endpoint tests")
- [ ] Changes are pushed to origin
- [ ] Commit includes only the test case additions

### Final Checklist

- [ ] All test cases written and pass
- [ ] Tests verify agent status retrieval
- [ ] Tests verify error handling
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

