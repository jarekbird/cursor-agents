# TASK-034.3: Test deleteQueue - queue with jobs error

**Section**: 3. QueueManager Enhancements
**Subsection**: 3.7.3
**Task ID**: TASK-034.3

## Description

Add a test case for the `deleteQueue` method to verify it correctly throws an error when attempting to delete a queue that has jobs or repeatable entries. This prevents data loss.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/queue/queue-manager.ts` - `deleteQueue()` method

## Current State

The `deleteQueue` method:
- Throws error if queue has jobs or repeatable entries

The test file `tests/queue/queue-manager.test.ts` exists with previous tests including TASK-034.1 and TASK-034.2.

**Important**: This task should be executed after TASK-034.2.

## Checklist

### Preparation and Setup

- [ ] Review `deleteQueue` jobs check logic
- [ ] Understand how jobs are detected (waiting/active/delayed/repeatable)
- [ ] Review test setup from previous subtasks

### Implementation Steps

- [ ] Step 1: Write test for queue with jobs
  - [ ] Create test: `it('should throw error when queue has jobs', async () => { ... })`
  - [ ] Arrange: 
    - [ ] Queue with waiting/active/delayed jobs or repeatable entries
  - [ ] Act: Call `deleteQueue('queue-with-jobs')`
  - [ ] Assert: Throws error about remaining jobs

### Specific Requirements

- [ ] Requirement 1: Test must verify jobs check
  - Acceptance: Appropriate error thrown when queue has jobs

### Error Handling and Edge Cases

- [ ] Test with waiting jobs
- [ ] Test with active jobs
- [ ] Test with delayed jobs
- [ ] Test with repeatable entries
- [ ] Verify error messages are descriptive

### Testing

- [ ] Run `npm run test:unit` to verify test executes
- [ ] Verify test passes consistently
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining why jobs check prevents deletion
- [ ] Document jobs check prevents data loss

### Verification

- [ ] Verify test passes consistently
- [ ] Verify jobs check works
- [ ] Confirm test follows project conventions

## Notes

- This task is part of **Phase 3 â€“ QueueManager Enhancements**
- **Execution Timing**: Should be executed after TASK-034.2
- **Dependencies**: 
  - TASK-034.2: Test deleteQueue - default queue protection
- **Important Considerations**: 
  - Jobs check prevents data loss
  - This is the third of 4 subtasks for TASK-034
- **Task Independence**: Can be completed independently after TASK-034.2
- **Current State**: Test file exists with previous tests

## Related Tasks

- Parent: TASK-034 (Add tests for deleteQueue)
- Previous: TASK-034.2 (Test deleteQueue - default queue protection)
- Next: TASK-034.4 (Test deleteQueue - successful deletion)
- Dependencies:
  - TASK-034.2: Test deleteQueue - default queue protection
- Related:
  - TASK-034.1, TASK-034.2, TASK-034.4: Other subtasks

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing a test case for `deleteQueue` when queue has jobs.

**Definition of Done**: "A test case is written that verifies `deleteQueue` correctly throws an error when attempting to delete a queue that has jobs or repeatable entries. The test passes consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify jobs check works so that queues with jobs aren't deleted.
   - **Acceptance Criteria**: 
     - Test verifies jobs check prevents deletion
     - Test passes consistently

### Automated Tests

The test case should be:

```typescript
describe('deleteQueue', () => {
  it('should throw error when queue has jobs', async () => {
    // Arrange: Queue with jobs
    // Act: deleteQueue('queue-with-jobs')
    // Assert: Throws error about remaining jobs
  });
});
```

- [ ] Test case written and passes
- [ ] Test verifies jobs check

### Git Commit and Push Requirements

- [ ] Test case added to `tests/queue/queue-manager.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add deleteQueue queue with jobs error test")
- [ ] Changes are pushed to origin
- [ ] Commit includes only this test case

### Final Checklist

- [ ] Test case written and passes
- [ ] Test verifies jobs check
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

