# TASK-010.1: Test getNextReadyTask when no tasks (returns null)

**Section**: 1. DatabaseService Unit Tests
**Subsection**: 1.7.1
**Task ID**: TASK-010.1

## Description

Add a test case for the `getNextReadyTask` method to verify it returns `null` when no tasks are available in the database. This is the simplest case and should be tested first.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/services/database-service.ts` (lines 111-135) - `getNextReadyTask()` method

## Current State

The `getNextReadyTask` method:
- Queries `tasks` table for tasks with `status IN (0, 4)` (ready or in_progress)
- Returns `null` if no tasks match

The test file `tests/services/database-service.test.ts` exists with system settings tests from previous tasks.

**Important**: This task should be executed after TASK-004 through TASK-009. This is the first subtask of TASK-010.

## Checklist

### Preparation and Setup

- [ ] Review `getNextReadyTask` implementation
- [ ] Understand `tasks` table schema: `id`, `prompt`, `"order"`, `uuid`, `status`
- [ ] Review SQLite table creation patterns

### Implementation Steps

- [ ] Step 1: Set up test database with tasks table
  - [ ] Create `tasks` table with required fields
  - [ ] Table should have: `id` (INTEGER PRIMARY KEY), `prompt` (TEXT), `"order"` (INTEGER), `uuid` (TEXT), `status` (INTEGER)
  - [ ] Do NOT insert any rows (empty table)
- [ ] Step 2: Write test for no tasks
  - [ ] Create test: `it('should return null when no tasks are available', () => { ... })`
  - [ ] Arrange: Empty `tasks` table
  - [ ] Act: Call `getNextReadyTask()`
  - [ ] Assert: Returns `null`

### Specific Requirements

- [ ] Requirement 1: Test must verify no tasks returns null
  - Acceptance: Empty table returns `null`
- [ ] Requirement 2: Test must set up database correctly
  - Acceptance: `tasks` table exists with correct schema
- [ ] Requirement 3: Test must verify empty table
  - Acceptance: No rows are inserted before calling method

### Error Handling and Edge Cases

- [ ] Handle case where table doesn't exist (should be created in setup)
- [ ] Verify method doesn't throw exceptions on empty table

### Testing

- [ ] Run `npm run test:unit` to verify test executes
- [ ] Verify test passes consistently
- [ ] Verify test is isolated
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining empty table test
- [ ] Document why null is returned

### Verification

- [ ] Verify test passes consistently
- [ ] Verify test data setup works
- [ ] Confirm test follows project conventions

## Notes

- This task is part of **Phase 1 â€“ DatabaseService Unit Tests**
- **Execution Timing**: Should be executed after TASK-004 through TASK-009
- **Dependencies**: 
  - TASK-004: Create a new test file for DatabaseService
  - TASK-005 through TASK-009: Previous DatabaseService tests
- **Important Considerations**: 
  - Use in-memory database for isolation
  - Create `tasks` table schema in test setup
  - This is the first of 4 subtasks for TASK-010
  - Table setup may be shared with other 10.x subtasks
- **Task Independence**: Can be completed independently after dependencies
- **Current State**: Test file exists with system settings tests

## Related Tasks

- Parent: TASK-010 (Test getNextReadyTask behavior)
- Next: TASK-010.2 (Test getNextReadyTask with tasks - status filtering)
- Dependencies:
  - TASK-004: Create a new test file for DatabaseService
  - TASK-005 through TASK-009: Previous DatabaseService tests
- Related:
  - TASK-010.2, TASK-010.3, TASK-010.4: Other subtasks for getNextReadyTask

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing a test case for `getNextReadyTask` when no tasks are available.

**Definition of Done**: "A test case is written that verifies `getNextReadyTask` returns `null` when no tasks are available. The test passes consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify empty task handling works so that the system handles no-work scenarios correctly.
   - **Acceptance Criteria**: 
     - Test verifies empty table returns `null`
     - Test passes consistently

### Automated Tests

The test case should be:

```typescript
describe('getNextReadyTask', () => {
  it('should return null when no tasks are available', () => {
    // Arrange: Empty tasks table
    const db = createTestDatabase();
    db.exec(`CREATE TABLE tasks (
      id INTEGER PRIMARY KEY,
      prompt TEXT,
      "order" INTEGER,
      uuid TEXT,
      status INTEGER
    )`);
    // No rows inserted
    const service = new DatabaseService(':memory:');
    
    // Act
    const result = service.getNextReadyTask();
    
    // Assert
    expect(result).toBeNull();
  });
});
```

- [ ] Test case written and passes
- [ ] Test verifies no tasks returns null

### Git Commit and Push Requirements

- [ ] Test case added to `tests/services/database-service.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add getNextReadyTask no tasks test")
- [ ] Changes are pushed to origin
- [ ] Commit includes only this test case

### Final Checklist

- [ ] Test case written and passes
- [ ] Test verifies no tasks returns null
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

