# TASK-033.2: Test removeAgent - error handling

**Section**: 3. QueueManager Enhancements
**Subsection**: 3.6.2
**Task ID**: TASK-033.2

## Description

Add a test case for the `removeAgent` method to verify it correctly handles errors when individual job removal operations fail, continuing to process other jobs and logging errors appropriately.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/queue/queue-manager.ts` - `removeAgent()` method

## Current State

The `removeAgent` method:
- Continues processing when individual job removal fails
- Logs errors for failed removals
- Still removes other jobs successfully

The test file `tests/queue/queue-manager.test.ts` exists with previous tests including TASK-033.1.

**Important**: This task should be executed after TASK-033.1.

## Checklist

### Preparation and Setup

- [ ] Review `removeAgent` error handling implementation
- [ ] Understand how errors are logged
- [ ] Review test setup from TASK-033.1

### Implementation Steps

- [ ] Step 1: Write test for error handling
  - [ ] Create test: `it('should continue when individual job removal fails', async () => { ... })`
    - [ ] Arrange: Some removal methods throw
    - [ ] Act: Call `removeAgent('test')`
    - [ ] Assert: 
      - [ ] Errors are logged
      - [ ] Process continues
      - [ ] Other jobs still removed

### Specific Requirements

- [ ] Requirement 1: Test must verify error handling
  - Acceptance: Individual failures don't abort process
- [ ] Requirement 2: Test must verify error logging
  - Acceptance: Errors are logged appropriately
- [ ] Requirement 3: Test must verify continuation
  - Acceptance: Other jobs are still removed despite errors

### Error Handling and Edge Cases

- [ ] Handle case where all removals fail
- [ ] Handle case where some removals fail
- [ ] Verify error messages are descriptive

### Testing

- [ ] Run `npm run test:unit` to verify test executes
- [ ] Verify test passes consistently
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining error handling approach

### Verification

- [ ] Verify test passes consistently
- [ ] Verify error handling works
- [ ] Confirm test follows project conventions

## Notes

- This task is part of **Phase 3 â€“ QueueManager Enhancements**
- **Execution Timing**: Should be executed after TASK-033.1
- **Dependencies**: 
  - TASK-033.1: Test removeAgent - remove jobs
- **Important Considerations**: 
  - This is the second of 5 subtasks for TASK-033
- **Task Independence**: Can be completed independently after TASK-033.1
- **Current State**: Test file exists with previous tests

## Related Tasks

- Parent: TASK-033 (Add tests for removeAgent and checkAndCleanupEmptyQueue)
- Previous: TASK-033.1 (Test removeAgent - remove jobs)
- Next: TASK-033.3 (Test checkAndCleanupEmptyQueue - delete non-default queue)
- Dependencies:
  - TASK-033.1: Test removeAgent - remove jobs
- Related:
  - TASK-033.1, TASK-033.3, TASK-033.4, TASK-033.5: Other subtasks

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing a test case for `removeAgent` error handling.

**Definition of Done**: "A test case is written that verifies `removeAgent` correctly handles errors when individual job removal operations fail, continuing to process other jobs and logging errors. The test passes consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify error handling works so that partial failures don't abort the entire removal process.
   - **Acceptance Criteria**: 
     - Test verifies errors are logged
     - Test verifies process continues
     - Test verifies other jobs are still removed
     - Test passes consistently

### Automated Tests

The test case should be:

```typescript
describe('removeAgent', () => {
  it('should continue when individual job removal fails', async () => {
    // Arrange: Some removal methods throw
    // Act: removeAgent('test')
    // Assert: Errors logged, process continues, other jobs removed
  });
});
```

- [ ] Test case written and passes
- [ ] Test verifies error handling

### Git Commit and Push Requirements

- [ ] Test case added to `tests/queue/queue-manager.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add removeAgent error handling test")
- [ ] Changes are pushed to origin
- [ ] Commit includes only this test case

### Final Checklist

- [ ] Test case written and passes
- [ ] Test verifies error handling
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

