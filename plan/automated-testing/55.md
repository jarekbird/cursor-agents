# TASK-055: Add targeted tests for uncovered branches

**Section**: 8. Coverage & CI Tightening
**Subsection**: 8.2
**Task ID**: TASK-055

## Description

Add targeted unit or integration tests for uncovered code branches identified in TASK-054. Focus on complex `if`/`catch` branches and error paths that weren't covered by previous tests. Follow existing test patterns and ensure new tests improve coverage.

**Reference Implementation**: 
- Coverage analysis results from TASK-054
- Existing test patterns in `tests/` directory
- Files with low coverage identified in TASK-054

## Current State

Coverage analysis from TASK-054 has identified under-covered areas:
- Specific files with low coverage
- Uncovered branches, functions, and error paths
- Complex conditional logic that needs testing

The test files exist but may not cover all branches identified in TASK-054.

**Important**: This task should be executed after TASK-054.

## Checklist

### Preparation and Setup

- [ ] Review coverage analysis results from TASK-054
- [ ] Identify specific uncovered branches and functions
- [ ] Review existing test patterns for consistency
- [ ] Prioritize gaps by importance and complexity

### Implementation Steps

- [ ] Step 1: Analyze coverage gaps
  - [ ] Review HTML coverage report for visual gaps
  - [ ] Identify specific uncovered lines and branches
  - [ ] Prioritize: error paths, complex conditionals, edge cases
- [ ] Step 2: Write targeted tests
  - [ ] For each uncovered area, write focused test
  - [ ] Follow existing test patterns
  - [ ] Ensure tests are isolated and focused
  - [ ] Cover error paths, edge cases, complex branches
- [ ] Step 3: Verify coverage improvement
  - [ ] Run `npm run test:coverage` again
  - [ ] Verify coverage increased for targeted files
  - [ ] Verify new tests pass
  - [ ] Document coverage improvements

### Specific Requirements

- [ ] Requirement 1: Test must target uncovered branches
  - Acceptance: Tests cover previously uncovered code
- [ ] Requirement 2: Test must follow existing patterns
  - Acceptance: Tests match project conventions
- [ ] Requirement 3: Test must improve coverage
  - Acceptance: Coverage metrics increase for targeted files
- [ ] Requirement 4: Test must be focused
  - Acceptance: Each test targets specific uncovered area

### Error Handling and Edge Cases

- [ ] Cover error paths that weren't tested
- [ ] Cover complex conditional branches
- [ ] Cover edge cases in logic
- [ ] Verify all new tests pass

### Testing

- [ ] Run `npm run test:unit` or `npm run test:http` to verify new tests execute
- [ ] Verify all new test cases pass
- [ ] Run `npm run test:coverage` to verify coverage improved
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining why tests target specific branches
- [ ] Document coverage improvements
- [ ] Note any remaining gaps for future work

### Verification

- [ ] Verify all new tests pass consistently
- [ ] Verify coverage improved for targeted files
- [ ] Verify no regressions introduced
- [ ] Confirm tests follow project conventions

## Notes

- This task is part of **Phase 8 â€“ Coverage & CI Tightening**
- **Execution Timing**: Should be executed after TASK-054
- **Dependencies**: 
  - TASK-054: Measure coverage and identify remaining gaps
- **Important Considerations**: 
  - Targeted tests improve coverage efficiently
  - Focus on error paths and complex branches
  - Follow existing test patterns for consistency
  - Coverage improvement should be measurable
  - Not all code needs 100% coverage (focus on important paths)
- **Task Independence**: Can be completed independently after TASK-054
- **Current State**: Coverage gaps identified, tests need to be written

## Related Tasks

- Previous: TASK-054 (Measure coverage and identify remaining gaps)
- Next: TASK-056 (Raise Jest coverage thresholds)
- Dependencies:
  - TASK-054: Measure coverage and identify remaining gaps
- Related:
  - TASK-056: Will set coverage thresholds based on improvements

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves adding targeted tests for uncovered code branches.

**Definition of Done**: "Targeted tests are added for uncovered branches identified in TASK-054. Tests follow existing patterns and improve coverage for targeted files. Coverage metrics show improvement. All tests pass consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to improve test coverage so that more code is tested.
   - **Acceptance Criteria**: 
     - Test verifies coverage improved for targeted files
     - Test verifies uncovered branches are now covered
     - Test passes consistently

2. **As a developer**, I want targeted tests so that coverage improves efficiently.
   - **Acceptance Criteria**:
     - Test verifies tests are focused on specific gaps
     - Test verifies tests follow existing patterns

### Automated Tests

**Note**: This task involves writing tests, not testing tests. Tests should target specific uncovered areas:

```typescript
// Example: Test for uncovered error branch
describe('Uncovered error path', () => {
  it('should handle specific error case', () => {
    // Arrange: Set up conditions for uncovered branch
    // Act: Trigger uncovered code path
    // Assert: Verify behavior
  });
});
```

- [ ] Targeted tests written for uncovered branches
- [ ] Tests follow existing patterns
- [ ] Coverage improved for targeted files
- [ ] All new tests pass

### Git Commit and Push Requirements

- [ ] Test cases added to appropriate test files
- [ ] Commit message follows project conventions (e.g., "test: add targeted tests for uncovered branches")
- [ ] Changes are pushed to origin
- [ ] Commit includes test additions and coverage improvements

### Final Checklist

- [ ] Targeted tests written and pass
- [ ] Coverage improved for targeted files
- [ ] Tests follow existing patterns
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete
