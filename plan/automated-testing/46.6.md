# TASK-046.6: Enhance MCP tests - get_queue_info JSON structure assertions

**Section**: 6. MCP Server Black-box Tests
**Subsection**: 6.1.6
**Task ID**: TASK-046.6

## Description

Enhance the existing test for the `get_queue_info` MCP tool to add comprehensive JSON payload assertions. The test should verify that `content[0].text` is valid JSON and assert the exact structure (keys, types) for the get_queue_info tool.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/mcp/server.ts` - `get_queue_info` tool handler
- `virtual-assistant/cursor-agents/tests/mcp/server.test.ts` - existing test structure

## Current State

The `get_queue_info` MCP tool:
- Gets info for specific queue
- Returns MCP response with `content[0].text` containing JSON
- JSON should contain: queue info structure

The test file `tests/mcp/server.test.ts` exists with previous tests including TASK-046.1 through TASK-046.5.

**Important**: This task should be executed after TASK-046.5.

## Checklist

### Preparation and Setup

- [ ] Review `get_queue_info` tool handler implementation
- [ ] Understand MCP response format (`content[0].text` as JSON)
- [ ] Review test setup from previous subtasks

### Implementation Steps

- [ ] Step 1: Enhance existing get_queue_info test with JSON assertions
  - [ ] Find existing test for get_queue_info
  - [ ] Add JSON parsing: `const content = JSON.parse(response.content[0].text)`
  - [ ] Assert queue info structure
  - [ ] Assert all required fields are present
  - [ ] Assert error structure when queue not found

### Specific Requirements

- [ ] Requirement 1: Test must verify JSON is valid
  - Acceptance: `content[0].text` parses as valid JSON
- [ ] Requirement 2: Test must verify structure
  - Acceptance: All required keys are present with correct types
- [ ] Requirement 3: Test must verify error structure
  - Acceptance: Error JSON structure when queue not found

### Error Handling and Edge Cases

- [ ] Assert error structure when queue not found
- [ ] Verify queue info structure
- [ ] Test with various queue states

### Testing

- [ ] Run `npm run test:unit` to verify test executes
- [ ] Verify test passes consistently
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining JSON structure assertions
- [ ] Document expected JSON schema for get_queue_info

### Verification

- [ ] Verify test passes consistently
- [ ] Verify JSON parsing works
- [ ] Verify structure assertions work
- [ ] Confirm test follows project conventions

## Notes

- This task is part of **Phase 6 â€“ MCP Server Black-box Tests**
- **Execution Timing**: Should be executed after TASK-046.5
- **Dependencies**: 
  - TASK-046.5: Enhance MCP tests - list_queues JSON structure assertions
- **Important Considerations**: 
  - This is the sixth of 7 subtasks for TASK-046
- **Task Independence**: Can be completed independently after TASK-046.5
- **Current State**: Test file exists with previous tests

## Related Tasks

- Parent: TASK-046 (Extend mcp/server.test.ts for JSON payload assertions)
- Previous: TASK-046.5 (Enhance MCP tests - list_queues JSON structure assertions)
- Next: TASK-046.7 (Enhance MCP tests - delete_queue JSON structure assertions)
- Dependencies:
  - TASK-046.5: Enhance MCP tests - list_queues JSON structure assertions
- Related:
  - TASK-046.1 through TASK-046.5, TASK-046.7: Other subtasks

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves enhancing the get_queue_info MCP tool test with JSON structure assertions.

**Definition of Done**: "The get_queue_info MCP tool test is enhanced with JSON parsing and structure assertions. Test verifies exact JSON structure (queue info fields). The test passes consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify JSON structure is correct so that MCP clients receive expected data.
   - **Acceptance Criteria**: 
     - Test verifies JSON is valid
     - Test verifies queue info structure is correct

### Automated Tests

Test enhancements should include:

```typescript
describe('get_queue_info MCP tool', () => {
  it('should return valid JSON with queue info structure', async () => {
    // Arrange & Act
    // Assert
    const content = JSON.parse(response.content[0].text);
    // Assert queue info structure
  });
});
```

- [ ] Test enhanced with JSON assertions
- [ ] Tests verify JSON validity and structure

### Git Commit and Push Requirements

- [ ] Test enhancements added to `tests/mcp/server.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: enhance get_queue_info MCP tool with JSON structure assertions")
- [ ] Changes are pushed to origin
- [ ] Commit includes only the test enhancements

### Final Checklist

- [ ] Test enhanced with JSON assertions
- [ ] Tests verify JSON validity and structure
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

