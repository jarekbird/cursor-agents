# TASK-032.5: Test findAgentQueue helper method

**Section**: 3. QueueManager Enhancements
**Subsection**: 3.5.5
**Task ID**: TASK-032.5

## Description

Add test cases for the `findAgentQueue` helper method to verify it correctly finds which queue contains a specific agent. This method is used by `getAgentStatus` to locate agents.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/queue/queue-manager.ts` - `findAgentQueue()` method

## Current State

The `findAgentQueue` method:
- Helper method that finds which queue contains the agent
- Used by `getAgentStatus`
- Returns queue name or null

The test file `tests/queue/queue-manager.test.ts` exists with previous tests including TASK-032.1 through TASK-032.4.

**Important**: This task should be executed after TASK-032.4, completing TASK-032.

## Checklist

### Preparation and Setup

- [ ] Review `findAgentQueue` implementation
- [ ] Understand how it searches queues
- [ ] Review test setup from previous subtasks

### Implementation Steps

- [ ] Step 1: Write test for queue found
  - [ ] Create test: `it('should find queue containing agent', async () => { ... })`
    - [ ] Arrange: Queue with matching agent jobs
    - [ ] Act: Call `findAgentQueue('test')`
    - [ ] Assert: Returns queue name
- [ ] Step 2: Write test for queue not found
  - [ ] Create test: `it('should return null when agent not in any queue', async () => { ... })`
    - [ ] Arrange: Queues with no matching jobs
    - [ ] Act: Call `findAgentQueue('non-existent')`
    - [ ] Assert: Returns `null`

### Specific Requirements

- [ ] Requirement 1: Test must verify queue discovery
  - Acceptance: Correct queue is found when agent exists
- [ ] Requirement 2: Test must verify not found case
  - Acceptance: Returns null when agent doesn't exist in any queue

### Error Handling and Edge Cases

- [ ] Handle case where multiple queues have matching agents
- [ ] Verify queue search logic

### Testing

- [ ] Run `npm run test:unit` to verify all tests execute
- [ ] Verify all test cases pass
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining findAgentQueue behavior
- [ ] Document queue search logic

### Verification

- [ ] Verify all test cases pass consistently
- [ ] Verify queue discovery works
- [ ] Confirm tests follow project conventions

## Notes

- This task is part of **Phase 3 â€“ QueueManager Enhancements**
- **Execution Timing**: Should be executed after TASK-032.4 (completes TASK-032)
- **Dependencies**: 
  - TASK-031: Add tests for addDelayedAgent
  - TASK-032.4: Test getAgentStatus - agentName in data matching
- **Important Considerations**: 
  - findAgentQueue is a helper method used by getAgentStatus
  - This is the fifth and final subtask for TASK-032
- **Task Independence**: Can be completed independently after TASK-032.4
- **Current State**: Test file exists with previous tests

## Related Tasks

- Parent: TASK-032 (Add tests for getAgentStatus and findAgentQueue)
- Previous: TASK-032.4 (Test getAgentStatus - agentName in data matching)
- Next: TASK-033 (Add tests for removeAgent and checkAndCleanupEmptyQueue)
- Dependencies:
  - TASK-032.4: Test getAgentStatus - agentName in data matching
- Related:
  - TASK-032.1 through TASK-032.4: Other subtasks for getAgentStatus

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing test cases for the `findAgentQueue` helper method.

**Definition of Done**: "Test cases are written that verify `findAgentQueue` correctly finds which queue contains an agent (returns queue name) or returns null when agent is not found. All tests pass consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify queue discovery works so that agents can be located across queues.
   - **Acceptance Criteria**: 
     - Test verifies correct queue is found when agent exists
     - Test verifies null is returned when agent doesn't exist
     - Test passes consistently

### Automated Tests

Test cases should include:

```typescript
describe('findAgentQueue', () => {
  it('should find queue containing agent', async () => {
    // Arrange: Queue with matching agent jobs
    // Act: findAgentQueue('test')
    // Assert: Returns queue name
  });
  
  it('should return null when agent not in any queue', async () => {
    // Arrange: Queues with no matching jobs
    // Act: findAgentQueue('non-existent')
    // Assert: Returns null
  });
});
```

- [ ] All test cases written and pass
- [ ] Tests verify queue discovery

### Git Commit and Push Requirements

- [ ] Test cases added to `tests/queue/queue-manager.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add findAgentQueue helper method tests")
- [ ] Changes are pushed to origin
- [ ] Commit includes only the test case additions

### Final Checklist

- [ ] All test cases written and pass
- [ ] Tests verify queue discovery
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete
- [ ] **TASK-032 (all subtasks) is complete**

