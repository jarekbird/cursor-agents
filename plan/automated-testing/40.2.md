# TASK-040.2: Add tests for GET /queues/:queueName - missing queue

**Section**: 5. HTTP/API Black-box Tests (App)
**Subsection**: 5.3.2
**Task ID**: TASK-040.2

## Description

Add a test case for the `GET /queues/:queueName` endpoint to verify it correctly returns 404 when a queue is not found. The test should verify the endpoint returns 404 with a descriptive error message.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/app.ts` - `GET /queues/:queueName` endpoint
- `virtual-assistant/cursor-agents/tests/app.test.ts` - existing test structure

## Current State

The `GET /queues/:queueName` endpoint:
- Returns 404 when queue is not found
- Returns descriptive error message

The test file `tests/app.test.ts` exists with previous tests including TASK-040.1.

**Important**: This task should be executed after TASK-040.1.

## Checklist

### Preparation and Setup

- [ ] Review `GET /queues/:queueName` endpoint implementation
- [ ] Understand error handling for missing queues
- [ ] Review test setup from TASK-040.1

### Implementation Steps

- [ ] Step 1: Write test for missing queue
  - [ ] Create test: `it('should return 404 when queue is not found', async () => { ... })`
    - [ ] Arrange: 
      - [ ] Mock `getQueueInfo` to return `null`
    - [ ] Act: GET `/queues/q1`
    - [ ] Assert: 
      - [ ] Response status is 404
      - [ ] Response body contains message `Queue "q1" not found`

### Specific Requirements

- [ ] Requirement 1: Test must verify missing queue handling
  - Acceptance: Returns 404 with descriptive message
- [ ] Requirement 2: Test must verify error message
  - Acceptance: Error message matches implementation exactly

### Error Handling and Edge Cases

- [ ] Handle case where queue name contains special characters
- [ ] Verify error messages are descriptive

### Testing

- [ ] Run `npm run test:http` to verify test executes
- [ ] Verify test passes consistently
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining error handling

### Verification

- [ ] Verify test passes consistently
- [ ] Verify error handling works
- [ ] Confirm tests follow project conventions

## Notes

- This task is part of **Phase 5 â€“ HTTP/API Black-box Tests (App)**
- **Execution Timing**: Should be executed after TASK-040.1
- **Dependencies**: 
  - TASK-040.1: Add tests for GET /queues/:queueName - existing queue
- **Important Considerations**: 
  - This is the second of 3 subtasks for TASK-040
- **Task Independence**: Can be completed independently after TASK-040.1
- **Current State**: Test file exists with previous tests

## Related Tasks

- Parent: TASK-040 (Add tests for /queues/:queueName)
- Previous: TASK-040.1 (Add tests for GET /queues/:queueName - existing queue)
- Next: TASK-040.3 (Add tests for GET /queues/:queueName - error handling)
- Dependencies:
  - TASK-040.1: Add tests for GET /queues/:queueName - existing queue
- Related:
  - TASK-040.1, TASK-040.3: Other subtasks

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves adding a test case for `GET /queues/:queueName` when queue is missing.

**Definition of Done**: "A test case is written that verifies `GET /queues/:queueName` correctly returns 404 with descriptive error message when queue is not found. The test passes consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify error handling works so that missing queues are handled gracefully.
   - **Acceptance Criteria**:
     - Test verifies missing queues return 404
     - Test verifies error message is descriptive

### Automated Tests

The test case should be:

```typescript
describe('GET /queues/:queueName', () => {
  it('should return 404 when queue is not found', async () => {
    // Arrange: getQueueInfo returns null
    mockQueueManager.getQueueInfo.mockReturnValue(null);
    
    // Act
    const response = await request(app.getApp())
      .get('/queues/q1')
      .expect(404);
    
    // Assert
    expect(response.body).toHaveProperty('message', 'Queue "q1" not found');
  });
});
```

- [ ] Test case written and passes
- [ ] Test verifies error handling

### Git Commit and Push Requirements

- [ ] Test case added to `tests/app.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add GET /queues/:queueName missing queue test")
- [ ] Changes are pushed to origin
- [ ] Commit includes only this test case

### Final Checklist

- [ ] Test case written and passes
- [ ] Test verifies error handling
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

