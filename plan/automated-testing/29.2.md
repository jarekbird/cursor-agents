# TASK-029.2: Test getOrCreateQueue - task-operator queue

**Section**: 3. QueueManager Enhancements
**Subsection**: 3.2.2
**Task ID**: TASK-029.2

## Description

Add a test case for the `getOrCreateQueue` method to verify it correctly creates the task-operator queue with concurrency 1. The test should verify that the special concurrency setting is applied for the task-operator queue.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/queue/queue-manager.ts` - `getOrCreateQueue()` method
- `virtual-assistant/cursor-agents/tests/queue/queue-manager.test.ts` - existing test structure

## Current State

The `getOrCreateQueue` method:
- Sets concurrency to 1 for `task-operator` queue
- Sets default concurrency for other queues

The test file `tests/queue/queue-manager.test.ts` exists with previous tests including TASK-029.1.

**Important**: This task should be executed after TASK-029.1.

## Checklist

### Preparation and Setup

- [ ] Review `getOrCreateQueue` task-operator special handling
- [ ] Understand why task-operator has concurrency 1
- [ ] Review test setup from TASK-029.1

### Implementation Steps

- [ ] Step 1: Write test for task-operator queue
  - [ ] Create test: `it('should create task-operator queue with concurrency 1', async () => { ... })`
  - [ ] Arrange: Queue name `'task-operator'`
  - [ ] Act: Call `getOrCreateQueue('task-operator')`
  - [ ] Assert: 
    - [ ] Worker factory called with `concurrency: 1`
    - [ ] Other factories called correctly

### Specific Requirements

- [ ] Requirement 1: Test must verify concurrency settings
  - Acceptance: task-operator has concurrency 1
- [ ] Requirement 2: Test must verify queue creation
  - Acceptance: Queue, worker, and events are created

### Error Handling and Edge Cases

- [ ] Test with various queue configurations
- [ ] Verify concurrency is exactly 1

### Testing

- [ ] Run `npm run test:unit` to verify all tests execute
- [ ] Verify all test cases pass
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining why task-operator has concurrency 1
- [ ] Document concurrency behavior

### Verification

- [ ] Verify all test cases pass consistently
- [ ] Verify concurrency settings work
- [ ] Confirm tests follow project conventions

## Notes

- This task is part of **Phase 3 â€“ QueueManager Enhancements**
- **Execution Timing**: Should be executed after TASK-029.1
- **Dependencies**: 
  - TASK-029.1: Test getOrCreateQueue - new queue creation
- **Important Considerations**: 
  - Concurrency 1 for task-operator prevents concurrent task processing
  - This is the second of 3 subtasks for TASK-029
- **Task Independence**: Can be completed independently after TASK-029.1
- **Current State**: Test file exists with previous tests

## Related Tasks

- Parent: TASK-029 (Add tests for getOrCreateQueue)
- Previous: TASK-029.1 (Test getOrCreateQueue - new queue creation)
- Next: TASK-029.3 (Test getOrCreateQueue - existing queue)
- Dependencies:
  - TASK-029.1: Test getOrCreateQueue - new queue creation
- Related:
  - TASK-029.1, TASK-029.3: Other subtasks

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing a test case for `getOrCreateQueue` when creating the task-operator queue.

**Definition of Done**: "A test case is written that verifies `getOrCreateQueue` correctly creates the task-operator queue with concurrency 1. The test passes consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify task-operator queue has correct concurrency so that tasks are processed sequentially.
   - **Acceptance Criteria**: 
     - Test verifies task-operator queue has concurrency 1
     - Test passes consistently

### Automated Tests

The test case should be:

```typescript
describe('getOrCreateQueue', () => {
  it('should create task-operator queue with concurrency 1', async () => {
    // Arrange: task-operator queue
    // Act: getOrCreateQueue('task-operator')
    // Assert: Worker created with concurrency 1
  });
});
```

- [ ] Test case written and passes
- [ ] Tests verify concurrency settings

### Git Commit and Push Requirements

- [ ] Test case added to `tests/queue/queue-manager.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add getOrCreateQueue task-operator queue test")
- [ ] Changes are pushed to origin
- [ ] Commit includes only this test case

### Final Checklist

- [ ] Test case written and passes
- [ ] Tests verify concurrency settings
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

