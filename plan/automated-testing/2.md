# TASK-002: Create/verify logical Jest script groups

**Section**: 0. Baseline & Tooling
**Subsection**: 0.2
**Task ID**: TASK-002

## Description

Create logical groupings of test scripts in `package.json` to allow running different types of tests independently. This enables faster feedback loops during development by running only relevant test suites (unit tests vs HTTP tests vs E2E tests). The scripts should use Jest's path filtering capabilities to target specific test directories.

**Reference Implementation**: `virtual-assistant/cursor-agents/package.json` (lines 7-23)

## Current State

The `package.json` currently has basic test scripts (`test`, `test:watch`, `test:coverage`) but lacks logical groupings. The test directory structure includes:
- `tests/queue/` - Unit tests for queue management
- `tests/mcp/` - Unit tests for MCP server
- `tests/services/` - Unit tests for services (to be created)
- `tests/app.test.ts` - HTTP/API-level tests
- `tests/integration.test.ts` - Integration tests

**Important**: This task should be executed after TASK-001 (verify existing test commands).

## Checklist

### Preparation and Setup

- [ ] Review current test directory structure
- [ ] Understand Jest path filtering options (`--testPathPattern`, `--runTestsByPath`)
- [ ] Review existing test file locations
- [ ] Verify Jest configuration supports path filtering

### Implementation Steps

- [ ] Step 1: Add `test:unit` script
  - [ ] Add script to `package.json`: `"test:unit": "NODE_OPTIONS=--experimental-vm-modules jest --testPathPattern='tests/(queue|mcp|services)' --passWithNoTests"`
  - [ ] Verify script targets: `tests/queue/`, `tests/mcp/`, `tests/services/`
- [ ] Step 2: Add `test:http` script
  - [ ] Add script to `package.json`: `"test:http": "NODE_OPTIONS=--experimental-vm-modules jest --testPathPattern='tests/(app|integration)\\.test' --passWithNoTests"`
  - [ ] Verify script targets: `tests/app.test.ts`, `tests/integration.test.ts`
- [ ] Step 3: Add `test:e2e-lite` script (reserved for future)
  - [ ] Add script to `package.json`: `"test:e2e-lite": "NODE_OPTIONS=--experimental-vm-modules jest --testPathPattern='tests/e2e' --passWithNoTests"`
  - [ ] Note: This directory may not exist yet, but script should be ready
- [ ] Step 4: Verify all scripts work
  - [ ] Run `npm run test:unit` and verify it executes
  - [ ] Run `npm run test:http` and verify it executes
  - [ ] Run `npm run test:e2e-lite` and verify it executes (may have no tests yet)

### Specific Requirements

- [ ] Requirement 1: `test:unit` script must target unit test directories
  - Acceptance: Running `npm run test:unit` only executes tests in `tests/queue/`, `tests/mcp/`, and `tests/services/`
- [ ] Requirement 2: `test:http` script must target HTTP/API test files
  - Acceptance: Running `npm run test:http` only executes `tests/app.test.ts` and `tests/integration.test.ts`
- [ ] Requirement 3: `test:e2e-lite` script must be ready for future E2E tests
  - Acceptance: Script exists and targets `tests/e2e/` directory (even if it doesn't exist yet)
- [ ] Requirement 4: All scripts must support ESM modules
  - Acceptance: All scripts include `NODE_OPTIONS=--experimental-vm-modules` flag

### Error Handling and Edge Cases

- [ ] Handle case where test directories don't exist yet (use `--passWithNoTests`)
- [ ] Verify scripts work when no tests match the pattern
- [ ] Ensure scripts don't conflict with existing `test` script
- [ ] Verify path patterns work correctly on different operating systems

### Testing

- [ ] Run `npm run test:unit` and verify it only runs unit tests
- [ ] Run `npm run test:http` and verify it only runs HTTP tests
- [ ] Run `npm run test:e2e-lite` and verify it executes (may pass with no tests)
- [ ] Verify scripts return appropriate exit codes
- [ ] **DO NOT manually test by running the server** - use automated verification of scripts only

### Documentation

- [ ] Document the purpose of each test script group in commit message
- [ ] Update any project documentation that references test commands
- [ ] Add comments in `package.json` if helpful (though JSON doesn't support comments)

### Verification

- [ ] Verify all three new test scripts are present
- [ ] Verify scripts correctly filter test files
- [ ] Verify no breaking changes to existing `test` script
- [ ] Confirm scripts follow project conventions

## Notes

- This task is part of **Phase 0 â€“ Baseline & Tooling**
- **Execution Timing**: Should be executed after TASK-001
- **Dependencies**: 
  - TASK-001: Verify existing test commands
- **Important Considerations**: 
  - Jest path patterns use regex, so special characters need escaping
  - The `--passWithNoTests` flag ensures scripts don't fail when directories don't exist yet
  - Path patterns should be tested to ensure they match intended files
- **Task Independence**: Can be completed independently after TASK-001
- **Current State**: Test scripts exist but lack logical groupings

## Related Tasks

- Previous: TASK-001 (Verify existing test commands)
- Next: TASK-003 (Confirm global Jest setup)
- Dependencies:
  - TASK-001: Must verify basic test scripts work first
- Related:
  - TASK-003: Will verify test setup that these scripts will use
  - TASK-004+: Will create tests that these scripts will run

## Definition of Done

### Task Type: CONFIGURATION TASK

**Description**: This task involves configuring test script groups in `package.json`.

**Definition of Done**: "All three test script groups (`test:unit`, `test:http`, `test:e2e-lite`) are added to `package.json` and verified to work correctly. Each script correctly filters and runs only its intended test files. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to run only unit tests so that I can get fast feedback during development.
   - **Acceptance Criteria**: 
     - `npm run test:unit` command exists
     - Command only runs tests in `tests/queue/`, `tests/mcp/`, and `tests/services/`
     - Command completes successfully

2. **As a developer**, I want to run only HTTP/API tests so that I can test API endpoints independently.
   - **Acceptance Criteria**:
     - `npm run test:http` command exists
     - Command only runs `tests/app.test.ts` and `tests/integration.test.ts`
     - Command completes successfully

3. **As a developer**, I want to run E2E tests separately so that I can run slower tests only when needed.
   - **Acceptance Criteria**:
     - `npm run test:e2e-lite` command exists
     - Command targets `tests/e2e/` directory
     - Command completes successfully (even if no tests exist yet)

### Automated Tests

**Note**: This is a configuration task, so automated tests are not required. However, the following verification steps must be completed:

- [ ] Manual verification: `npm run test:unit` executes and filters correctly
- [ ] Manual verification: `npm run test:http` executes and filters correctly
- [ ] Manual verification: `npm run test:e2e-lite` executes (may have no tests)

### Git Commit and Push Requirements

- [ ] All changes to `package.json` are committed to git
- [ ] Commit message follows project conventions (e.g., "test: add test script groups for unit, http, and e2e tests")
- [ ] Changes are pushed to origin
- [ ] Commit includes only changes related to this task

### Final Checklist

- [ ] All three test script groups added to `package.json`
- [ ] Scripts verified to filter tests correctly
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete
