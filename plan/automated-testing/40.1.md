# TASK-040.1: Add tests for GET /queues/:queueName - existing queue

**Section**: 5. HTTP/API Black-box Tests (App)
**Subsection**: 5.3.1
**Task ID**: TASK-040.1

## Description

Add a test case for the `GET /queues/:queueName` endpoint to verify it correctly returns queue info for existing queues. The test should verify the endpoint returns 200 with the queue info JSON.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/app.ts` - `GET /queues/:queueName` endpoint
- `virtual-assistant/cursor-agents/tests/app.test.ts` - existing test structure

## Current State

The `GET /queues/:queueName` endpoint:
- Gets info for specific queue
- Returns 200 with queue info JSON for existing queues

The test file `tests/app.test.ts` exists but may not have comprehensive `GET /queues/:queueName` endpoint tests.

**Important**: This task should be executed after TASK-039. This is the first subtask of TASK-040.

## Checklist

### Preparation and Setup

- [ ] Review `GET /queues/:queueName` endpoint implementation
- [ ] Understand `getQueueInfo` usage
- [ ] Review existing `app.test.ts` structure
- [ ] Understand queue info structure

### Implementation Steps

- [ ] Step 1: Write test for existing queue
  - [ ] Create test: `it('should return queue info for existing queue', async () => { ... })`
    - [ ] Arrange: 
      - [ ] Mock `queueManager.getQueueInfo` to return sample queue object for `"q1"`
      - [ ] Create app instance
    - [ ] Act: GET `/queues/q1` using `supertest`
    - [ ] Assert: 
      - [ ] Response status is 200
      - [ ] Response body equals mock queue info

### Specific Requirements

- [ ] Requirement 1: Test must verify existing queue handling
  - Acceptance: Returns 200 with queue info
- [ ] Requirement 2: Test must verify queue name parameter
  - Acceptance: Queue name is passed correctly to `getQueueInfo`

### Error Handling and Edge Cases

- [ ] Handle case where queue name contains special characters
- [ ] Test with various queue info structures

### Testing

- [ ] Run `npm run test:http` to verify test executes
- [ ] Verify test passes consistently
- [ ] Verify existing tests still pass
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining queue endpoint behavior

### Verification

- [ ] Verify test passes consistently
- [ ] Verify queue info retrieval works
- [ ] Confirm tests follow project conventions

## Notes

- This task is part of **Phase 5 â€“ HTTP/API Black-box Tests (App)**
- **Execution Timing**: Should be executed after TASK-039
- **Dependencies**: 
  - TASK-039: Add tests for /admin/queues/refresh
- **Important Considerations**: 
  - This is the first of 3 subtasks for TASK-040
- **Task Independence**: Can be completed independently after TASK-039
- **Current State**: Test file exists but may not have comprehensive GET /queues/:queueName endpoint tests

## Related Tasks

- Parent: TASK-040 (Add tests for /queues/:queueName)
- Next: TASK-040.2 (Add tests for GET /queues/:queueName - missing queue)
- Dependencies:
  - TASK-039: Add tests for /admin/queues/refresh
- Related:
  - TASK-040.2, TASK-040.3: Other subtasks

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves adding a test case for `GET /queues/:queueName` when queue exists.

**Definition of Done**: "A test case is written that verifies `GET /queues/:queueName` correctly returns queue info for existing queues. The test passes consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify queue info retrieval works so that queue details can be accessed via API.
   - **Acceptance Criteria**: 
     - Test verifies existing queues return 200 with queue info
     - Test passes consistently

### Automated Tests

The test case should be:

```typescript
describe('GET /queues/:queueName', () => {
  it('should return queue info for existing queue', async () => {
    // Arrange: Mock getQueueInfo
    mockQueueManager.getQueueInfo.mockReturnValue({
      name: 'q1',
      waiting: 0,
      active: 0,
    });
    
    // Act
    const response = await request(app.getApp())
      .get('/queues/q1')
      .expect(200);
    
    // Assert
    expect(response.body).toEqual({
      name: 'q1',
      waiting: 0,
      active: 0,
    });
  });
});
```

- [ ] Test case written and passes
- [ ] Test verifies queue info retrieval

### Git Commit and Push Requirements

- [ ] Test case added to `tests/app.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add GET /queues/:queueName existing queue test")
- [ ] Changes are pushed to origin
- [ ] Commit includes only this test case

### Final Checklist

- [ ] Test case written and passes
- [ ] Test verifies queue info retrieval
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

