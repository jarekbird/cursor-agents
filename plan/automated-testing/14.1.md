# TASK-014.1: Test getTaskStatus method

**Section**: 1. DatabaseService Unit Tests
**Subsection**: 1.11.1
**Task ID**: TASK-014.1

## Description

Add test cases for the `getTaskStatus` method to verify it correctly reads task statuses from the database. The tests should cover reading status for existing tasks, non-existent tasks, and error cases where queries fail.

**Reference Implementation**: 
- `virtual-assistant/cursor-agents/src/services/database-service.ts` (lines 205-215) - `getTaskStatus()` method

## Current State

The `getTaskStatus` method:
- Queries `tasks` table for status by task ID
- Returns status number or `null` if task not found
- Returns `null` on error and logs the error

The test file `tests/services/database-service.test.ts` exists with previous task tests.

**Important**: This task should be executed after TASK-010 through TASK-013. This is the first subtask of TASK-014.

## Checklist

### Preparation and Setup

- [ ] Review `getTaskStatus` implementation
- [ ] Understand status constants: 0=ready, 1=complete, 2=archived, 3=backlogged, 4=in_progress
- [ ] Review how to create test data in SQLite

### Implementation Steps

- [ ] Step 1: Set up test database with tasks table
  - [ ] Create `tasks` table with required fields
  - [ ] Insert multiple tasks with different statuses
- [ ] Step 2: Write tests for `getTaskStatus`
  - [ ] Create test: `it('should return task status for existing task', () => { ... })`
    - [ ] Arrange: Insert task with `id=1`, `status=0` (ready)
    - [ ] Act: Call `getTaskStatus(1)`
    - [ ] Assert: Returns `0`
  - [ ] Create test: `it('should return null for non-existent task', () => { ... })`
    - [ ] Arrange: Empty table or task with different ID
    - [ ] Act: Call `getTaskStatus(999)`
    - [ ] Assert: Returns `null`
  - [ ] Create test: `it('should return null and log error when query fails', () => { ... })`
    - [ ] Arrange: Drop table or cause error
    - [ ] Act: Call `getTaskStatus(1)`
    - [ ] Assert: Returns `null`, error is logged

### Specific Requirements

- [ ] Requirement 1: Test must verify getTaskStatus returns correct status
  - Acceptance: Existing task returns its status, non-existent returns null
- [ ] Requirement 2: Test must verify error handling
  - Acceptance: Query errors return null and log errors

### Error Handling and Edge Cases

- [ ] Handle case where table doesn't exist
- [ ] Handle case where task ID is invalid
- [ ] Test with tasks having various statuses

### Testing

- [ ] Run `npm run test:unit` to verify all tests execute
- [ ] Verify all test cases pass
- [ ] Verify tests are isolated
- [ ] Run full test suite to ensure no regressions
- [ ] **DO NOT manually test by running the server** - use automated tests only

### Documentation

- [ ] Add comments explaining status constants
- [ ] Note any edge cases covered

### Verification

- [ ] Verify all test cases pass consistently
- [ ] Verify status reading works correctly
- [ ] Confirm tests follow project conventions

## Notes

- This task is part of **Phase 1 â€“ DatabaseService Unit Tests**
- **Execution Timing**: Should be executed after TASK-010 through TASK-013
- **Dependencies**: 
  - TASK-004: Create a new test file for DatabaseService
  - TASK-010 through TASK-013: Previous DatabaseService tests
- **Important Considerations**: 
  - Use in-memory database for isolation
  - Test both reading and writing task statuses
  - Status constants are: 0=ready, 1=complete, 2=archived, 3=backlogged, 4=in_progress
  - This is the first of 2 subtasks for TASK-014
- **Task Independence**: Can be completed independently after dependencies
- **Current State**: Test file exists with previous task tests

## Related Tasks

- Parent: TASK-014 (Test getTaskStatus and markTaskComplete)
- Next: TASK-014.2 (Test markTaskComplete method)
- Dependencies:
  - TASK-004: Create a new test file for DatabaseService
  - TASK-010 through TASK-013: Previous DatabaseService tests
- Related:
  - TASK-014.2: Will test markTaskComplete

## Definition of Done

### Task Type: TESTING TASK

**Description**: This task involves writing test cases for the `getTaskStatus` method.

**Definition of Done**: "Test cases are written that verify `getTaskStatus` correctly reads task statuses (existing, non-existent, errors). All tests pass consistently. All changes have been committed to git and pushed to origin."

### User Stories

1. **As a developer**, I want to verify task status can be read so that I can check task state.
   - **Acceptance Criteria**: 
     - Test verifies existing task returns correct status
     - Test verifies non-existent task returns null
     - Test verifies error handling works

### Automated Tests

Test cases should include:

```typescript
describe('getTaskStatus', () => {
  it('should return task status for existing task', () => {
    // Arrange: Insert task with status 0
    // Act: getTaskStatus(1)
    // Assert: Returns 0
  });
  
  it('should return null for non-existent task', () => {
    // Arrange: No task with ID
    // Act: getTaskStatus(999)
    // Assert: Returns null
  });
  
  it('should return null and log error when query fails', () => {
    // Arrange: Drop table
    // Act: getTaskStatus(1)
    // Assert: Returns null, error logged
  });
});
```

- [ ] All test cases written and pass
- [ ] Tests cover getTaskStatus (existing, non-existent, errors)
- [ ] Tests are properly isolated

### Git Commit and Push Requirements

- [ ] Test cases added to `tests/services/database-service.test.ts`
- [ ] Commit message follows project conventions (e.g., "test: add getTaskStatus tests")
- [ ] Changes are pushed to origin
- [ ] Commit includes only the test case additions

### Final Checklist

- [ ] All test cases written and pass
- [ ] Tests cover getTaskStatus scenarios
- [ ] All changes committed to git
- [ ] Code pushed to origin
- [ ] Task marked as complete

